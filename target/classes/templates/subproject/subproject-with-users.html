<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SubProject With Users</title>
</head>
<body>
<h1>Brugere tilknyttet subprojekt</h1>

<!-- Fejlbesked -->
<section th:if="${error}" class="error-section">
    <p th:text="${error}" class="error-message"></p>
</section>

<!-- Kort info om subprojekt -->
<section class="mini-info">
    <div>Navn: <span th:text="${subProjectWithUsers.subProject.name}"></span></div>
    <div>Deadline: <span th:text="${subProjectWithUsers.subProject.deadline}"></span></div>
    <div>Status: <span th:text="${subProjectWithUsers.subProject.status}"></span></div>
</section>

<!-- Brugere tilknyttet subprojektet -->
<section class="mini-info">
    <div th:if="${!#lists.isEmpty(subProjectWithUsers.userViewDTOList)}">
        <div th:each="user : ${subProjectWithUsers.userViewDTOList}" class="user-summary">
            <span th:text="${user.firstName + ' ' + user.lastName + ' (' + user.role + ')'}"></span>
            <a th:href="@{/users/{userId}(userId=${user.userId})}">Se detaljer</a>
        </div>
    </div>
    <!-- Hvis listen er tom -->
    <div th:if="${#lists.isEmpty(subProjectWithUsers.userViewDTOList)}">
        Der er ingen brugere tilknyttet dette subprojekt.
    </div>
</section>


<!-- Tilknyt brugere til subprojekt -->
<h2>Tildel nye brugere</h2>

<section class="form-actions">
    <form th:action="@{'/subprojects/' + ${subProjectWithUsers.subProject.subProjectId} + '/assignusers'}"
          method="post">
        <div>
            <label for="user-select">Vælg én eller flere brugere:</label><br/>
            <select id="user-select" name="userIds" multiple size="5">
                <option th:each="user : ${unassignedUsers}"
                        th:value="${user.userId}"
                        th:text="${user.firstName + ' ' + user.lastName + ' (' + user.role + ')'}">
                </option>
            </select>
        </div>
        <div>
            <button type="submit">Tildel valgte brugere</button>
        </div>
    </form>
</section>

<!-- Navigation -->
<section class="navigation">

    <div>
        <!-- Tilbage til subproject-detail.html er for alle -->
        <a th:href="@{/subprojects/{id}(id=${subProjectWithUsers.subProject.subProjectId})}">
            <button>Tilbage til subprojekt</button>
        </a>
    </div>
    <!-- Tilbage til subprojekt-list.html kun for admin -->
    <div>
        <a th:if="${session.currentUser.role.name() == 'ADMIN'}"
           th:href="@{/subprojects/list}">
            <button>Tilbage til subprojektoversigt</button>
        </a>
    </div>
    <!-- Tilbage til forsiden -->
    <div>
        <a th:href="@{/users/profile}">
            <button>Tilbage til forside</button>
        </a>
    </div>
</section>


</body>
</html>